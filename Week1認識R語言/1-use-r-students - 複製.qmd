# Posit Cloud使用

進入大數據、人工智慧的時代，程式語言是進行數據分析必備的利器。

## R簡介

### R語言與R軟體

1. **用R軟體學R語言**

- **R語言**源自於S語言，是基於Fortran語言所開發的一種程式語言。第一個版本在1976-1980進行開發。1980 年將S語言移植到 Unix系統， 並對外發佈原始程式碼，1984 年授權原始程式碼。這個舊S的版本和現在用的S語言有所差別。現在所用的S語言始於1989–1988開發的第二個版本，以及1992年開發的第三版，增強物件導向的特性與統計建模功能，是我們現在最常使用的版本。雖然1998年改進了程式設計功能，變成第四版的S語言。不過，並沒有廣泛地被採用，僅用於S語言的商業化S-PLUS上。 

- **R軟體**是一個自由軟體，最初由紐西蘭 Auckland 大學的 Ross Ihaka 和 Robert Gentleman 於 1997 年發佈。因為兩個人的名字都以R開頭，所以命名為“R”，到目前為止，R軟體仍然是經濟系做數據分析的首選！

- [Wiki - R] (https://zh.wikipedia.org/wiki/R%E8%AF%AD%E8%A8%80)



2. **水果刀與瑞士刀**

- R，一種程式語言與自由軟體，由統計學家所研發，主要用於統計分析、統計繪圖、資料處理。

R is a programming language and free software environment for statistical computing and graphics.

- Python是一種廣泛使用的直譯式、通用目的的高階程式語言。

Python is an interpreted high-level general-purpose programming language.

![](./Figures/StatisticalPrograms.png)

![](./Figures/Popularity.png)

[Python vs. R for Data Science : What’s the Difference?](https://www.datacamp.com/community/blog/when-to-use-python-or-r?fbclid=IwAR3c60NxwH3x2FTe2JYdxip_UhfdaEYOoxL_feTdUN78PRh4neu1v3cWjO4)


### 下載與安裝

1. **下載R軟體**

<img src="./Figures/CRAN-1.png" style="zoom: 25%;" />

(1) 前往 The Comprehensive R Archive Network (CRAN)

[官網網址](https://cran.r-project.org/)： <https://cran.r-project.org/>。

(2)可以直接利用雲端[0-Cloud]中的地址，或離自己最近的台灣的鏡像下載<https://cran.csie.ntu.edu.tw/>。

(3) 如果作業系統是 Mac 請點選 Download R for (Mac) OS X；

如果作業系統是 Windows 請點選 Download R for Windows。

<img src="./Figures/CRAN-2.png" style="zoom:33%;" />

- 以Windows為例， 下載 R 軟體安裝檔 **base套件**。

<img src="./Figures/CRAN-3.png" style="zoom: 25%;" />


**補充說明：base R 大套件**

-整個R系統是由一系列的套件（Package）所組成(別人寫好的程式，可以直接使用)。

- R軟體自帶的大套件是base R套件，由25個（核心）套件所組成，本身具備完整的分析功能。要用R軟體進行分析，建議先學會base套件的基礎功能。除此之外，CRAN上還有上萬個附加套件，由R核心開發團隊之外的用戶自行研發，如此多的套件讓R幾乎可以實現目前所有的統計分析。

- tidyverse套件是數據分析常用的另一個大套件。

- 大一和大二以base R套件為主，學習R語言的基本功能；大三則是以tidyverse R套件為主，主要教授資料視覺化、資料整理。



2. **安裝R軟體**

[參考：安裝影片](https://www.youtube.com/watch?v=Viteqr5DLWo)

下載完畢之後執行安裝檔，依照提示訊息點選確認或下一步就能完成安裝；由於現在多數電腦都已經為 64位元，建議不需要勾選安裝 32 位元的檔案。

**補充說明: Windows系統的使用建議 **

建議 1：安裝或使用時，可以系統管理員身份進行。

建議 2：不要設定中文使用者名稱。

若是用中文使用者名稱，日後在RStudio安裝套件會有問題。解決的方式有幾個：

- 新增使用者，使用者名稱用英文。可參考：https://reurl.cc/m3jyoY
- 改用陽春的R軟體安裝套件。
- 將R/Rstuio安裝在D槽。
- 也可以照下面方式修改
    - 右鍵**我的電腦** -> 屬性 -> 高級系統設置 -> 高級 -> 環境變數
    - 把TEMP和TMP都修改為，C:\TEMP
    - 在C目錄下創建資料夾TEMP
    - 重啟Rstudio

建議 3：不要安裝在 Windows 的 OneDrive 資料夾。

若同學想要安裝onedrive，請在最初安裝onedrive時，不要選擇onedrive與文件夾(documents)同步，就不會有問題。

建議4: 將錯誤訊息的提示改成英文的，方便日後在網路上發問。

![](./Figures/English.png)

建議 5: R軟體一年更新四次，Windows系統不會自動覆蓋舊版的R語言，可以下載`installr`套件，用於更新R軟體。


## R Studio軟體

### 整合開發環境

1. **整合開發環境（Integrated Development Environment，簡稱IDE)**，是一種輔助程式開發的應用軟體，通常包含文字編輯器（撰寫程式）、直譯器（翻成0/1的機器碼）與除錯器（找出程式的錯誤）等工具。


2. **RStudio軟體**讓我們編寫R程式時更為方便。

在日常工作中，通常不直接使用R軟體自帶的RGui工具進行數據分析，而是使用Rstudio軟體工作。Rstudio是為R語言所設計的一種整合開發環境，支持Linux, macOS, Windows等操作系統，2011年發佈第一個公開測試版，2016年推出第一個正式版本，並陸續更新。

- [Wiki - Rstudio](https://zh.wikipedia.org/wiki/RStudio)



### 下載與安裝

3. 下載RStudio軟體

[RStudio官網下載：](https://rstudio.com/products/rstudio/download/)<https://rstudio.com/products/rstudio/download/>

前往Download RStudio，如果使用的作業系統是 Mac 請點選 RStudio X.X.XXX - Mac OS X XX.X+ ，如果使用的作業系統是 Windows 請點選 RStudio X.X.XXX - Windows Vista/7/8/10。請安裝64bit即可。

依照圖中紅色方框點選連結下載RStudio軟體。

- 下載 Mac的 RStudio 安裝檔
- 下載 Windows 的RStudio安裝檔

<img src="./Figures/RStudio.png" style="zoom: 25%;" />

4. **安裝RStudio軟體**

下載完畢之後執行安裝檔，依照提示訊息點選確認或下一步就能完成安裝。

[參考：安裝影片](https://www.youtube.com/watch?v=5Ms94m9RqK4)

### RStudio的使用：四個區塊

Rstudio是目前市佔率最高的Ｒ語言開發工作環境。

**開啟RStudio**

1. 第一次執行 RSudio 時，如下圖顯示三個區塊。

<img src="./Figures/RStudio-1.png" style="zoom: 33%;" />

2. 在畫面的左上角有一個開啟新文件的 icon，請按RScript，開啟一個新的文件檔 編寫R程式。

File => New File => RScript

<img src="./Figures/RStudio-2.jpg" style="zoom: 33%;" />

3.  此時，畫面變成四個區塊，這是Rstudio使用中最常見的樣貌。


<img src="./Figures/RStudio-3.jpg"  style="zoom: 67%;" />

**RStudio四區塊簡介**

+ 命令列 Console (左下角，命令執行窗口)

+ 來源 Source (左上角，代碼編輯窗口)

+ 環境管理窗口 Environment、History (右上角，物件暫存區、變數瀏覽窗口)

+ 文件管理窗口 Files、Plots、Packages、Help、Viewer (右上角，其他功能)


1. **命令列（Console）**：位於左下角，是執行程式的區塊，為命令執行窗口。

- R Console負責執行代碼並顯示程式執行的結果，不管是失敗或成功都會在此顯示。


2. **來源（Source）**：位於左上角，是編寫程式代碼的區塊，為腳本編輯窗口。

- 使用正規腳本模式撰寫程式碼，請開啟 RScript檔案（副檔名為.R)。

3. **環境管理窗口**：位於右上角，記憶體內的物件，為物件暫存區、變數瀏覽窗口。

- 環境（Environment）：變數清單。用于顯示內存中已經生成的變數。
- 歷史（History）：指令執行記錄。按掃帚圖示，可清除歷史的操作步驟紀錄。
- 查詢（Help）：顯示查詢文件。（請移到環境管理窗口，使用更方便）


4. **文件管理窗口**：位於右下角，可以直接點擊代碼或者文本文件，並在窗口中對其進行修改。

- 檔案（Files）：目前工作目錄下的檔案，方便讀取與處理。
	- 查看目前專案計畫下的檔案名稱。
- 圖形（Plots）：顯示畫好的圖表。
	- 圖形繪製是數據分析過程中的必要操作，一款好的數據分析工具，必須具備圖形繪製功能。
	- RStudio集成了圖形繪製的功能，只需執行繪圖代碼，圖形展示窗口就會繪製出相應的數據圖形。
	- 有時還是需要到原始R軟體中執行才行。
- 套件（Packages）：套件清單與安裝。
- 預覽器（Viewer）：顯示網頁。


＝> 本課程將使用雲端系統，雲端的RStudio和桌機下載的RStudio，在使用上幾乎相同，因此請同學參考後面講義的相關操作。

## Posit Cloud 簡介

RStudio公司為R語言提供了方便的操作介面，此整合開發環境稱為RStudio軟體，可以免費直接下載，Mac和Windows作業系統都可以使用。由於這兩個作業系統，在操作細節上有所不同，甚至於同一個作業系統，也會因為電腦配備和軟體版本不同而不完全相容，會發生在A電腦可以成功操作，但在B電腦不行的情況（Python也一樣）。因此，RStudio公司在雲端設立了RStudio Cloud讓R軟體的使用者，利用RStudio公司的統一設備與畫面進行操作，大大降低了系統差異所造成的困擾，就如同Google公司建立的Colab讓人使用Python一樣。只是Google是一間大公司，RStudio是一間小公司，在使用優惠上有所差距，RStudio可免費使用的時間是一個月25小時。因此，建議同學可用兩個Email註冊，或者是搭配桌機使用。

又，R和Python是目前數據分析最常被使用的兩種程式語言。使用Python進行數據分析的人數大增，2022年RStudio公司決定擴大服務範圍，將Python納入，改名為Posit。也因此，R Studio Cloud改名為Posit Cloud，原本RStudio公司所推出的R語言套件，慢慢地都朝著R和Python二者都可以使用的方向前進。


### Posit Cloud

1. Posit Cloud 網址：https：//posit.cloud

<img src="./Figures/Posit-1.jpg" style="zoom: 33%;" />


2. 註冊(sign up) 或登入(log in)

請輸入你的電子郵件，先註冊，以後均是登入。

<img src="./Figures/Posit-2.png" style="zoom:33%;" />

<img src="./Figures/Posit-3.png" style="zoom:33%;" />

<img src="./Figures/Posit-4.png" style="zoom:33%;" />


3. 點擊New Project來新建Project

project是RStudio Cloud的基本工作單位，用來儲存R代碼、R套件及資料。

<img src="./Figures/Posit-5.png" style="zoom:33%;" />

**範例1：建立一個自己的專案管理檔案，將上課的講義、資料與程式等檔案都放在一起，並置於特定的專案（子目錄）之中，例如BasicR。**

<img src="./Figures/Posit-6.png" style="zoom:33%;" />

專案計畫可用相對路徑存取檔案。通常，專案計畫是針對特定用途，有系統的將相關檔案存放在一起，可用相對路徑存取檔案。Posit Cloud是用這種比較先進的方式操作。又，目前大部分的統計軟體則是以工作目錄的方式提供類似的功能，在RStudio的桌機版，則是二者均提供。

### Posit/Rstudio四區塊的外觀設定

雲端和桌機的使用畫面非常類似，請將先將Posit變成四個視窗區塊，然後進行外觀設定。

- 四個區塊：File => New File => RScript

- 外觀設定：Tools -> Global Options中的選項，請自己依照需要調整測試
    - Code: 關閉代碼提示功能，在Completions中的Show Code Completions選Manually。
    - Code:編碼，在Saving的Default text encoding中，選UTF-8。
    - Appearance：可以調整字體、字體大小、Workspace 與 Console 的 theme。
    - Pane Layout：調整開啟畫面的左上、左下、右上、右下的內容，可以自動調整。（可將help移到環境管理窗口）

## 常用功能

桌機和雲端常用操作功能均相同

![](./Figures/RStudio-4.jpg)


### 兩種使用模式（左邊區塊）

RStudio/Posit有兩種常見的使用模式：互動模式與正規模式。

**模式一：互動模式（Interactive Mode）** （左下方區塊）

1. R是直譯式語言。

啟動 R 軟體後進入命令列介面後，可以直接在命令列執行程式指令，然後觀看結果。

- **打完代碼後，請按`Enter`執行**。
- **可用`ctrl+L`清空命令列。**

範例2: 請在控制台執行下面代碼

```{r}
5
1 + 1
print(2 + 2)
print("Hello World")
```

2. 控制台執行視窗(Console)中的符號

- 若視窗出現**`>`**時，表示可輸入指令；
- 若視窗出現**`+`**時，表示前面的程式碼還沒打完，必須鍵入完整的程式碼讓R執行。
- 可以用**上下左右游標鍵**查找歷史命令、修改後再次執行。
  - 或用`Ctrl+C 複製`、用`Ctrl+V 貼`


**模式二: 正規模式（Normal Mode）- 腳本、命令稿** （左上方區塊）


1. 用文字編輯器撰寫並儲存程式。

程式檔案稱為腳本、命令稿(script)， R語言腳本檔案的附檔名是".r"。

- Step1: 在 RStudio 中，建立一個來源程式檔（指令檔）。
	- 用File => New File => R Script
	- 或點選`+`號，開啟一個新的 R script 檔案(.r)
- Step2: 在左上方，程式碼編輯區 Source editor撰寫程式碼
	- 程式編輯允許同時打開多個文件進行編輯
	- 但是每次只能編輯一個文件\
	- 單擊窗口上面的文件名稱，可以切換編輯文件。

2. 用直譯器將R指令分譯成電腦懂的0與1語言。

- Step3: 邊寫程式、邊測試。
	- 先用滑鼠標出欲執行的程式碼(Highlight)
	- 按`快捷鍵Ctrl+Enter`或單擊`Run`，執行選定的程式碼
	- 程式碼會在左下方Console視窗執行，並顯示結果
	- 寫完一部分就運行一部分，沒有錯誤才繼續寫下一部分。
	- 為了閱讀方便，請用`井字號#`加上註解。
	- 單擊`Source`按鈕，則執行整個程式檔代碼。

- Step 4: 儲存檔案。
	- 整個程式寫完後，從頭到尾執行R腳本上的程式，確認正確無誤。
	- 指令為`source("filename.r", encoding = "UTF-8")`。
	- 儲存程式檔案、儲存執行檔案。

範例3: 請在來源撰寫程式檔案並執行。

```{r}
## 實際操作一次，檔名test.r
## 整行加註時，用兩個井字號開頭；指令後加註，用一個井字號。
## 指派與四則運算子前後建議空一格，逗號後面亦要空一格。

## R as a calculator
print(1+1)    # 加法運算子
print(sqrt(2))  # 函數
```

3. 錯誤訊息

- 用RStudio寫程式的一個好處是可以預先知道程式有錯誤的地方。
	- 指令稿會以紅色波浪線和側邊欄的交叉圖示凸顯語法有錯的地方
	- 指令稿會以驚嘆號發出警告。
	- 請將滑鼠移到交叉或驚嘆號圖示的地方，看看發生了什麼問題。

- 用直譯器執行後，可以從Console看執行結果。
	- Message：有可能的錯誤通知，程式會繼續執行
	- Warning：有錯誤，但是不會影響太多，程式會繼續執行
	- Error：有錯，而且無法繼續執行程式
	- Condition：可能會發生的情況

4. **常用的快速鍵**

- 剪下：ctrl+X
- 複製：ctrl+C
- 貼上：ctrl+V
- 全選：ctrl+A
- 清除：ctrl+L
- 執行：ctrl+Enter
- 存檔：ctrl+S
- 上一步：ctrl+Z

5. **文書處理**

＝>若程式執行沒有任何問題，要將程式與執行結果一併輸出，進行文書處理。此時，請按菜單最旁邊的筆記本，RStudio會替你進行簡單的編譯工作，等高年級時再學自行設計的細節。

- 進行程式檔案的編譯(Compile)，即文書處理作業，請選擇Word檔。
	- 雲端編譯好的Word檔，會存在雲端(OK)，也可以直接下載(Download)。
	- 桌機則是會直接開啟編譯好的Word檔。

<img src="./Figures/Posit-7.png" style="zoom:33%;" />
<img src="./Figures/Posit-8.png" style="zoom:33%;" />
<img src="./Figures/Posit-9.png" style="zoom:33%;" />

### 右邊區的常用功能

**1. 檔案與上傳下載（右下方區塊）**

- 檔案是指在專案計畫工作目錄中的檔案
	- 在雲端，全都使用相對路徑，即只用檔名即可。
	- 在雲端，通過upload和export，可以上傳和下載檔案。

<img src="./Figures/Posit-12.png" style="zoom: 33%;" />

<img src="./Figures/Posit-13.png" style="zoom: 33%;"/>


**2.套件的使用 （右下方區塊）**

套件是由R函數、數據和欲編譯代碼等檔案所組成，是別人替你寫好的完整功能檔案集。
通常，**使用套件的程序有兩個階段，一個是安裝，另外一個是載入。**這兩者的區別就像是買書跟閱讀書，安裝套件就像是把書買回家裡放在書櫃中，書只需買一次、套件也只需下載一次即可；載入套件就像是把書從書櫃取下閱讀，書可以看很多次、需要套件時也可以多次載入使用。

**步驟一:安裝套件**

+ **在文件管理視窗(Rstudio右下視窗)用按的**
    - Packages -> Install Packages 安裝套件
    - 鍵入套件名稱
    - 勾"Install dependencies"

**步驟二:載入套件**

+ 透過文件管理視窗的 Package，將要載入的 package 打勾即可。
+ **在 console 輸入指令載入，指令為`library(套件名稱)`。**
	+ 在指令稿一開始的地方，用`library()`指令放上你要載入的套件
	+ 例如：`library(ggplot2) # ggplot2 一個畫圖套件`。
	+ 導入套件後，可以直接通過函數名稱使用套件內的函數。

注意，在雲端，不同Project之間是完全獨立的，所以R套件並非共用。新建project需要重新安裝R套件，因此可以考慮使用同一個Project，減少安裝套件的麻煩。


**3.分享專案**

預設情況下，你創建的任何Project都只能自己訪問。若要分享，得更改設定。

<img src="./Figures/Posit-10.png" style="zoom: 33%;" />

- 先在設定中，將“誰可以查看該項目”更改為“所有人”(右上角的齒輪)。
	- 在流覽器中複製專案位址並發送連結。
	- 注意，任何有連結的使用者都可以查看你的項目。
	- 當你訪問由其他人創建的項目時，Posit Cloud會自動創建原始專案的臨時副本。你可以使用它並對其進行編輯，但是任何更改都不會反映在原始版本中。
	- 如果你想保留所做的更改，只需按下save a Permanent copy按鈕為自己保存一個專案的副本。
- 若要與他人共用一個專案，則要按一下專案設置按鈕(右上角的圓圈三點)。

### 離開 RStudio/Posit

**兩種離開的方式**

(1) 點擊視窗的 X 離開，或(2)在命令列（Console）輸入 `q()` 離開。

- 離開時候會詢問是否要儲存您的工作空間，如果您希望下一次啟動時保有目前環境中的物件，可以選擇儲存工作空間。
	- 儲存工作空間：結束工作時，可以考慮儲存工作空間，save.image (filename.RData)
	- 儲存工作物件：將物件名稱為XXX的特定物件，儲存到RData附加檔名的yyy檔案 save (XXX, file = “yyy.RData)
	- 載入工作目錄：load(filename.RData)



